@model BugTracker.Models.Ticket

@{
    ViewBag.Title = "Details";
}

<h2>Details</h2>

<div>
    <h4>Ticket</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.AssignedToUser.Email)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.AssignedToUser.Email)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.OwnerUser.Email)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.OwnerUser.Email)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Project.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Project.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.TicketPriority.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.TicketPriority.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.TicketStatus.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.TicketStatus.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.TicketType.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.TicketType.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Titile)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Titile)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Description)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Description)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Created)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Created)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Updated)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Updated)
        </dd>

    </dl>
</div>
<h3>Comments</h3>
<table class="table">
    <tr>
        <th>
           Titile
        </th>
        <th>
           User
        </th>
        <th>
            Comment Context
        </th>
        <th>
            Create Time
        </th>
    </tr>

    @foreach (var c in ViewBag.Comments)
    {
        <tr>
            <td>
                @c.Ticket.Titile
            </td>
            <td>
                @c.User.Email
            </td>
            <td>
                @c.Comment
            </td>
            <td>
                @c.Created
            </td>
        </tr>
    }
    </table>

    @if (ViewBag.Identity == "Admin" || @Model.OwnerUserId == ViewBag.UserId || Model.AssignedToUserId == ViewBag.UserId)
    {
        <p>
            @Html.ActionLink("Add a comment", "../TicketComments/Create", new { TicketId = Model.Id }, null)
        </p>
    }
<h3>Attachment</h3>
<table class="table">
    <tr>
        <th>
           Ticket
        </th>
        <th>
           User Name
        </th>
        <th>
           FilePath
        </th>
        <th>
           Description
        </th>
        <th>
           Create Time
        </th>
        <th>
           FileUrl
        </th>
        <th></th>
    </tr>

    @foreach (var a in ViewBag.Attachments)
    {
        <tr>
            <td>
                @a.Ticket.Titile
            </td>
            <td>
                @a.User.Email
            </td>
            <td>
                @a.FilePath
            </td>
            <td>
                @a.Description
            </td>
            <td>
                @a.Created
            </td>
            <td>
                @a.FileUrl
            </td>
        </tr>
    }

</table>

    @if (ViewBag.Identity == "Admin" || @Model.OwnerUserId == ViewBag.UserId || Model.AssignedToUserId == ViewBag.UserId)
    {
        <p>
            @Html.ActionLink("Add an attachment", "AddAttachment", new { TicketId = Model.Id }, null)
        </p>
    }

    <p>
        @Html.ActionLink("Edit", "Edit", new { id = Model.Id }) |
        @Html.ActionLink("Back to List", "Index")
    </p>
